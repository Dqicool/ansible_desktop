  - name: copy cvmfs and nfs config
    copy:
      src: ../files/cvmfs_nfs_fstab
      dest: /root/cvmfs_nfs_fstab
      owner: root
      group: wheel
      mode: '0644'
  
  - name: Ensures /mnt/MS dir exists
    file: path=/mnt/MS state=directory

  - name: Ensures /mnt/CCTV dir exists
    file: path=/mnt/CCTV state=directory

  - name: Ensures /mnt/NVME dir exists
    file: path=/mnt/NVME state=directory

  - name: Ensures /cvmfs/atlas.cern.ch  dir exists
    file: path=/cvmfs/atlas.cern.ch  state=directory
  
  - name: Ensures /cvmfs/atlas-condb.cern.ch  dir exists
    file: path=/cvmfs/atlas-condb.cern.ch  state=directory

  - name: Ensures /cvmfs/atlas-condb.cern.ch  dir exists
    file: path=/cvmfs/atlas-condb.cern.ch  state=directory

  - name: Ensures /cvmfs/grid.cern.ch  dir exists
    file: path=/cvmfs/grid.cern.ch  state=directory

  - name: Ensures /cvmfs/sft.cern.ch  dir exists
    file: path=/cvmfs/sft.cern.ch  state=directory

  - name: Ensures /cvmfs/atlas-nightlies.cern.ch  dir exists
    file: path=/cvmfs/atlas-nightlies.cern.ch  state=directory

  - name: append cvmfs and nfs to fstab
    shell: if cat /etc/fstab | grep cvmfs; then echo "done"; else cat /root/cvmfs_nfs_fstab >> /etc/fstab; fi;

  - name: etc cvmfs def.loacl change to atlas
    shell: sed -i -e 's/CVMFS_REPOSITORIES=atlas.cern.ch,atlas-condb.cern.ch,grid.cern.ch,sft.cern.ch,lhcb.cern.ch,lhcbdev.cern.ch/CVMFS_REPOSITORIES=atlas.cern.ch,atlas-condb.cern.ch,grid.cern.ch,sft.cern.ch,atlas-nightlies.cern.ch/' /etc/cvmfs/default.local

  - name: remove tmp files
    file: 
      path: ../../ansible_desktop/files/cvmfs_nfs_fstab
      dest: /root/cvmfs_nfs_fstab
      state: absent